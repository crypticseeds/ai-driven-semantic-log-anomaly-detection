[SERVICE]
    Flush         5
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf
    # Enable position tracking database to remember file offsets across restarts
    storage.path  /fluent-bit/db/

# Docker container logs - collects logs from all containers with service name
# Using multiline parsing to group Python stack traces
[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224
    Tag               docker.*

# Alternative: Read Docker logs directly from files with multiline support
# [INPUT]
#     Name              tail
#     Path              /var/lib/docker/containers/*/*.log
#     Tag               docker.container
#     Parser            docker
#     Multiline.parser  docker_multiline
#     Refresh_Interval  5
#     Mem_Buf_Limit     50MB
#     Skip_Long_Lines   On
#     DB                /fluent-bit/db/docker.db
#     Read_from_Head    Off

# Host system logs - tagged as "host" service
[INPUT]
    Name              tail
    Path              /var/log/*.log
    Tag               host.logs
    Parser            json
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    DB                /fluent-bit/db/host_logs.db
    Read_from_Head    Off

[INPUT]
    Name              tail
    Path              /var/log/syslog
    Tag               host.syslog
    Parser            syslog
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    DB                /fluent-bit/db/host_syslog.db
    Read_from_Head    Off

# Optional: Uncomment if nginx is running and logs are available
# [INPUT]
#     Name              tail
#     Path              /var/log/nginx/*.log
#     Tag               logs.nginx
#     Parser            nginx
#     Refresh_Interval  5
#     Mem_Buf_Limit     50MB
#     Skip_Long_Lines   On

# Optional: Uncomment if opentelemetry logs are available
# [INPUT]
#     Name              tail
#     Path              /var/log/opentelemetry/*.log
#     Tag               logs.opentelemetry
#     Parser            opentelemetry
#     Refresh_Interval  5
#     Mem_Buf_Limit     50MB
#     Skip_Long_Lines   On

# Multiline filter for Docker forward logs - groups Python stack traces
[FILTER]
    Name                  multiline
    Match                 docker.*
    Multiline.key_content log
    Multiline.parser      docker_multiline

[FILTER]
    Name                modify
    Match               docker.*
    Add                 environment docker

# Add "host" as service name for host system logs
[FILTER]
    Name                modify
    Match               host.*
    Add                 service host
    Add                 environment host

[FILTER]
    Name                modify
    Match               logs.*
    Add                 service fluentbit
    Add                 environment docker

[OUTPUT]
    Name        kafka
    Match       *
    Brokers     kafka:9092
    Topics      logs-raw
    Format      json
